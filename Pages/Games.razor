@page "/games"
@using Microsoft.JSInterop
@using PhantomAirInvite.Shared.Games
@inject IJSRuntime JS

@code {
  // Non-romantic, Phantom/Chicago flavored
  private static readonly string[] Pool = new[] {
    "ðŸŽŸ Any Alcohol you want!", "ðŸ§¤ Winter Kit (Gloves + Warmers)", "Airplane Pillow",
    "â˜• Chick-fil-A Gift Card", "Ulta Gift Card", "Bag of Candy",
    "ðŸŽ­ Phantom Pin/Sticker", "Socks", "ðŸ§¼ Travel Mini Kit", "Donut"
  };

  string? scratchPrize;
  string? memoryPrize;

  string PickRandom() => Pool[Random.Shared.Next(Pool.Length)];
  string PickDistinct(string other)
  {
    string p;
    do p = PickRandom(); while (p == other);
    return p;
  }

  protected override async Task OnInitializedAsync()
  {
    // try to load persisted prizes
    try
    {
      scratchPrize = await JS.InvokeAsync<string>("storage.get", "phantom_scratch_prize");
      memoryPrize  = await JS.InvokeAsync<string>("storage.get", "phantom_memory_prize");
    }
    catch { /* ok first run */ }

    if (string.IsNullOrWhiteSpace(scratchPrize) || string.IsNullOrWhiteSpace(memoryPrize))
    {
      var first  = scratchPrize ?? PickRandom();
      var second = memoryPrize  ?? PickDistinct(first);

      scratchPrize = first;
      memoryPrize  = second;

      try
      {
        await JS.InvokeVoidAsync("storage.set", "phantom_scratch_prize", scratchPrize);
        await JS.InvokeVoidAsync("storage.set", "phantom_memory_prize",  memoryPrize);
      }
      catch { /* ignore */ }
    }
  }
}

<div class="section" style="display:grid;place-items:center;gap:14px">
  <h2>Quick Games</h2>

  <p class="card" style="max-width:720px">
    Earn up to <strong>2 prizes</strong> tonightâ€”one from each game. Redeem with the host during the presentation.
  </p>

  <!-- SCRATCH-OFF -->
  <div class="card" style="margin-top:8px; max-width: 360px; width:100%">
    <h3 style="margin-top:0">Scratch-Off: Reveal the Mask</h3>
    <div class="scratch-wrap" style="max-width: 320px; margin-inline:auto;">
      <ScratchOff
        PrizeText="@(scratchPrize ?? "ðŸŽŸ Mystery Prize")"
        CoverColor="#3a1012"
        Width="280"
        Height="150"
        Threshold="0.55" />
    </div>
    <p style="font-size:.9rem;opacity:.8;margin-top:8px">(Prize limit 1 from this game)</p>
  </div>

  <!-- MEMORY MATCH -->
  <div class="card" style="margin-top:8px; max-width: 360px; width:100%">
    <h3 style="margin-top:0">Memory Match: Light the Candles</h3>
    <div style="max-width: 320px; margin-inline:auto;">
      <MemoryMatch />
    </div>
    <div class="prize-callout" style="margin-top:10px">
      <strong>Prize on win:</strong> @(memoryPrize ?? "ðŸŽŸ Mystery Prize")
    </div>
    <p style="font-size:.9rem;opacity:.8;margin-top:8px">(Prize limit 1 from this game)</p>
  </div>
</div>
